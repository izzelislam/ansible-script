# Deploy Laravel Application Playbook
# This playbook deploys a Laravel application (assumes webserver already configured)
#
# Usage:
#   First deployment: ansible-playbook playbooks/deploy-laravel.yml -e "first_install=true"
#   Regular deploy:   ansible-playbook playbooks/deploy-laravel.yml
#   With seeders:     ansible-playbook playbooks/deploy-laravel.yml -e "run_seeders=true"

- name: Deploy Laravel Application
  hosts: cokelatos
  become: true
  
  vars:
    # Application Configuration
    project_name: "sinaucodeV2"
    domain: "sinaucode.dev"
    repo_url: "git@github.com:username/repo.git"
    git_branch: "main"
    
    # PHP Version
    php_version: "8.3"
    
    # Deployment User (should have SSH access to git repo)
    deploy_user: "cokelatos"
    
    # Database Configuration
    db_name: "sinaucodedb"
    db_user: "newadmin"
    db_pass: "{{ vault_db_pass | default('secretStrongP@ssw0rd!') }}"
    
    # Application Settings
    app_name: "SinauCode"
    app_env: production
    app_debug: "false"
    app_timezone: "Asia/Jakarta"
    
    # Caching (recommended for production)
    cache_config: true
    cache_routes: true
    cache_views: true
    
    # Feature flags
    enable_maintenance_mode: true
    run_seeders: false

  roles:
    - role: laravel
      tags: [laravel, deploy]

  post_tasks:
    - name: Display deployment information
      debug:
        msg: |
          ‚úÖ Deployment completed successfully!
          
          üìã Application Details:
          - Project: {{ project_name }}
          - Domain: {{ domain }}
          - Path: /var/www/{{ project_name }}
          - PHP Version: {{ php_version }}
          
          üìù Next steps:
          - Verify the application is running
          - Check logs at /var/log/nginx/{{ project_name }}_error.log
